# import dota2api
# import json
#
# api = dota2api.Initialise("1352C13082943B1B20DB841C2034BB4D")
# # data = api.get_heroes()
# # data = api.get_match_details(match_id=6650850666)
# data = api.get_match_history(account_id=170206880, hero_id=[14],matches_requested=5)
#
#
# with open('data.json', 'w') as write_file:
#     json.dump(data, write_file,indent=4)

# signed_integer = 22
#
# # Adding 1<<32 to convert signed to
# # unsigned integer
# unsigned_integer = signed_integer+(1 << 32)
#
# print(unsigned_integer)



from requests_html import HTMLSession
import requests
from bs4 import BeautifulSoup
import re
from db_heroes import returnHeroViaId
import fake_useragent
from selenium import webdriver
from random_user_agent.user_agent import UserAgent
from random_user_agent.params import SoftwareName, OperatingSystem
# from random_proxies import random_proxy


regex = r"\d+"


def getDBMatches(userId, hero_id=404, ranked=None):
    session = HTMLSession()


#      proxer = ["194.67.150.254:56302", "190.144.224.182:44550","195.140.226.32:5678","203.142.68.210:5678","78.83.242.229:4145","103.192.76.36:5678","217.219.76.40:4153","109.238.208.138:51372","103.231.78.36:80","185.181.61.186:52345","187.44.167.78:47074","14.241.182.44:5678","35.244.6.175:1080","92.255.164.166:4145","88.255.185.234:1082","77.235.28.229:4153","83.168.84.142:4153","123.31.12.41:53711","202.70.68.149:1088","159.223.163.11:48436","212.47.228.149:64143","77.220.40.102:1080","185.236.46.221:5678","82.99.204.198:1080","43.245.216.116:5678","123.200.4.42:4145","98.103.88.147:46104","187.32.248.50:5678","85.92.165.225:4145","196.27.105.130:4153","163.53.186.250:5678","119.197.0.17:4145","131.108.60.22:3629","113.160.227.32:1080","102.36.209.185:5678","190.186.216.196:5678","81.12.124.224:5678","182.52.67.122:50801","5.44.254.40:4145","138.201.140.90:15976","89.228.128.216:5678","103.136.163.66:4153","1.179.173.114:4153","93.185.93.162:35625","212.3.105.11:4145","74.62.55.194:64312","62.171.166.158:25332","176.31.226.57:9999","154.113.66.70:5678","178.63.232.191:443","178.216.0.168:39316","110.235.255.179:5678","110.77.149.50:5678","94.28.14.70:4145","93.184.151.48:5678","209.198.43.57:5678","5.172.188.92:5678","77.238.79.111:5678","190.182.88.214:30956","105.213.103.203:5678","82.103.70.227:4145","181.204.12.122:5678","43.250.107.91:80","103.248.40.110:5678","176.114.244.92:33722","181.15.154.156:52033","93.87.74.222:4153","187.122.13.70:5678","155.93.255.137:4153","45.170.46.49:3629","103.60.214.18:51754","103.76.15.202:5678","181.204.4.74:5678","190.239.24.74:5678","103.107.37.113:4145","88.255.102.114:1082","103.102.142.98:4145","114.141.51.227:5678","183.89.249.192:4153","111.95.108.120:4153","186.97.233.58:5678","94.23.147.123:8444","36.91.216.243:8080","103.40.122.194:1080","181.115.232.158:4153","103.106.193.117:7532","45.70.15.4:8080","103.105.70.9:30538","103.126.87.25:1080","113.160.214.209:19132","85.248.57.129:4153","192.158.15.201:50877","110.78.153.239:4145","37.186.5.16:5678","117.54.106.241:8080","178.63.244.28:4003","187.84.254.178:53382","170.0.92.64:9812","94.101.187.82:3128","125.228.43.81:8080","188.133.173.21:8080","185.32.6.131:8090","192.171.119.166:53149","116.197.134.98:8080","179.1.77.222:999","103.135.220.92:8080","203.150.128.173:8080","143.244.133.78:80","190.61.101.39:8080","78.84.14.122:53281","46.101.186.238:80","182.253.191.132:8080","180.183.228.121:8080","193.138.146.67:3128","212.46.230.102:6969","181.115.187.218:8080","203.174.13.158:8082","173.82.149.243:8080","201.219.194.203:8080","128.199.108.87:8080","47.241.245.186:80","117.54.114.103:80","165.227.71.60:80","187.217.54.84:80","216.137.184.253:80","91.209.11.132:80","189.203.234.146:999","67.212.186.100:80","85.159.2.171:8080","154.13.5.42:59394","85.94.81.194:8080","91.134.136.29:9000","66.196.238.179:3128","138.68.238.19:31028","185.51.10.19:80","51.91.62.219:80","201.217.49.2:80","36.90.229.178:8080","167.71.5.83:8080","146.59.83.187:80","67.212.186.102:80","154.13.5.41:59394","223.205.77.160:8080","47.241.165.133:443","64.227.62.123:80","178.32.101.200:80","67.212.186.99:80","103.149.162.194:80","43.255.113.232:8082","103.148.72.106:80","158.69.52.218:9300","20.110.214.83:80","129.41.171.244:8000","107.179.33.13:80","169.57.1.85:8123","49.207.36.81:80","45.142.106.198:80","139.99.237.62:80","45.142.106.197:80","218.250.242.225:80","103.219.194.13:80","13.125.238.23:3128","139.59.1.14:8080","103.149.162.195:80","47.74.152.29:8888","197.243.14.59:8888","20.230.193.232:80","103.232.215.194:80","103.219.194.12:80","67.212.186.101:80","66.29.154.103:3128","20.245.120.25:3128","5.161.105.105:80
# ","195.80.49.10:80
# ","206.54.182.179:3128
# ","51.250.80.131:80
# ","20.47.108.204:8888
# ","66.29.154.105:3128
# ","121.1.41.162:111
# ","65.108.145.53:3128
# ","202.57.55.242:45112
# ","41.65.174.120:1976
# ","136.233.136.41:48976
# ","171.233.151.214:55443
# ","183.88.184.192:18080
# ","190.98.1.99:3128
# ","202.138.249.241:8000
# ","182.72.150.242:8080
# ","77.50.104.110:3128
# ","200.105.215.18:33630
# ","8.219.97.248:80
# ","78.46.123.202:80
# ","198.41.67.18:8080
# ","103.157.117.82:3125
# ","20.81.62.32:3128
# ","65.108.244.191:3128
# ","206.189.195.74:8080
# ","105.112.191.250:3128
# ","59.124.224.205:3128
# ","198.59.191.234:8080
# ","64.189.24.250:3129
# ","204.199.174.67:999
# ","157.100.12.138:999
# ","216.238.71.78:59394
# ","216.238.70.190:59394
# ","216.238.74.199:59394
# ","178.32.148.251:8080
# ","37.112.57.47:8080
# ","35.234.248.49:3128
# ","38.146.52.234:3128
# ","74.62.23.242:39593
# ","200.27.110.28:57702
# ","14.99.214.169:5678
# ","1.9.213.114:4153
# ","78.31.94.118:1080
# ","103.153.35.73:5678
# ","37.59.215.78:51916
# ","180.211.191.38:5678
# ","45.162.4.49:51508
# ","161.49.158.165:5678
# ","195.149.98.30:56897
# ","217.12.201.56:11337
# ","45.70.30.199:5678
# ","201.93.159.234:4145
# ","168.90.89.238:4145
# ","117.102.89.74:5678
# ","36.95.84.225:5678
# ","196.3.97.71:5678
# ","36.84.59.53:4145
# ","45.250.65.188:5678
# ","8.42.68.197:39593
# ","194.228.84.10:4145
# ","103.160.201.47:1080
# ","124.109.22.174:5678
# ","138.197.105.130:8444
# ","49.51.69.212:21127
# ","45.248.41.198:4673
# ","103.156.17.62:1080
# ","200.116.198.140:37092
# ","203.176.139.14:33427
# ","122.53.82.126:4145
# ","206.192.226.90:39593
# ","197.232.39.208:14880
# ","41.215.82.214:4673
# ","5.11.17.230:1080
# ","176.88.177.197:61080
# ","46.174.235.84:5678
# ","185.43.249.148:39316
# ","185.95.199.103:1099
# ","196.41.102.130:60216
# ","45.71.185.42:3629
# ","70.60.132.130:5678
# ","182.52.51.181:3629
# ","200.101.150.202:8080
# ","103.158.121.186:1088
# ","138.68.3.159:3128
# ","1.0.136.5:4145
# ","45.191.204.235:3128
# ","1.186.85.74:5678
# ","85.30.215.48:32946
# ","91.244.69.154:5678
# ","31.207.58.115:5678
# ","41.87.29.62:9898
# ","160.19.155.51:8080
# ","80.244.229.55:1256
# ","197.234.183.130:1080
# ","125.25.45.11:8080
# ","5.22.208.41:80
# ","194.12.124.188:3629
# ","34.75.123.131:80
# ","103.215.177.137:3125
# ","91.209.11.131:80
# ","190.217.69.202:999
# ","164.163.133.13:999
# ","119.93.129.34:80
# ","82.137.244.151:8080
# ","178.49.236.109:1080
# ","190.14.249.119:999
# ","103.148.72.126:80
# ","109.108.68.144:41890
# ","190.217.69.203:999
# ","115.74.213.139:8080
# ","103.162.205.252:8181
# ","183.88.212.247:1080
# ","117.54.114.97:80
# ","45.189.254.10:999
# ","182.253.70.113:3127
# ","84.214.150.146:8080
# ","143.198.182.218:80
# ","165.16.27.33:1976
# ","196.1.95.117:80
# ","144.76.241.45:7890
# ","103.219.194.11:80
# ","197.243.14.90:8888
# ","167.235.63.238:3128
# ","1.214.62.61:8000
# ","62.205.169.74:53281
# ","177.242.148.14:999
# ","81.91.144.190:55443
# ","103.197.45.166:8080
# ","181.205.41.210:7654
# ","183.89.97.74:8080
# ","159.192.253.92:8080
# ","159.65.69.186:9300
# ","194.44.104.242:31280
# ","1.10.141.220:54620
# ","178.254.41.91:8118
# ","103.152.100.187:8080
# ","165.227.205.246:8081
# ","58.147.186.228:3125
# ","149.248.6.218:3128
# ","137.184.191.61:3080
# ","43.129.223.147:38080
# ","62.75.206.151:3128
# ","114.245.35.47:8118
# ","183.111.25.253:8080
# ","103.252.1.137:3128
# ","85.14.243.31:3128
# ","20.203.160.74:3128
# ","181.176.211.168:8080
# ","149.202.181.48:5566
# ","37.120.192.154:8080
# ","147.135.134.57:5566
# ","43.224.10.22:6666
# ","89.234.182.234:80
# ","13.250.53.121:3128
# ","45.90.164.114:80
# ","180.183.202.123:9898
# ","199.58.128.75:8080
# ","94.247.241.70:51006
# ","186.159.17.194:5678
# ","1.20.184.75:4153
# ","103.59.190.209:56252
# ","176.37.36.224:5678
# ","91.244.114.193:31080
# ","188.165.254.122:9420
# ","185.140.100.178:5678
# ","103.154.145.90:4153
# ","47.57.188.208:80
# ","103.108.243.238:5678
# ","181.48.70.30:4153
# ","210.211.122.40:46338
# ","50.233.42.98:30717
# ","113.162.84.218:1080
# ","212.233.164.245:1080
# ","36.89.126.79:5678
# ","103.197.206.69:5678
# ","81.12.96.214:5678
# ","151.80.252.69:7532
# ","103.76.201.165:5678
# ","202.21.112.172:1080
# ","93.150.57.242:1088
# ","62.201.212.198:4673
# ","64.124.191.98:32688
# ","190.123.226.109:5678
# ","110.78.147.101:4145
# ","185.83.252.11:59311
# ","201.184.230.34:5678
# ","138.0.229.232:4153
# ","24.88.66.70:64312
# ","91.134.139.238:3080
# ","159.224.187.170:5678
# ","115.164.146.18:13629
# ","41.163.7.46:5678
# ","37.26.136.224:4153
# ","5.178.217.227:31019
# ","31.173.140.183:3629
# ","50.192.49.195:32100
# ","103.78.210.178:30000
# ","36.95.213.247:5678
# ","143.202.136.55:4153
# ","110.77.135.70:4145
# ","192.162.193.243:54313
# ","181.199.122.74:5678
# ","134.19.254.2:4153
# ","102.128.173.1:5678
# ","188.251.218.144:4153
# ","202.162.219.10:1080
# ","91.236.157.57:3629
# ","138.0.207.18:38328
# ","135.181.48.41:4444
# ","50.251.146.121:5678
# ","203.192.199.238:5678
# ","103.207.98.82:41238
# ","46.21.77.122:4153
# ","102.66.233.176:5678
# ","182.52.70.117:4145
# ","190.99.112.94:5678
# ","168.205.218.85:4145
# ","200.85.95.234:4153
# ","70.60.96.154:5678
# ","185.47.184.253:45463
# ","201.48.62.65:4145
# ","162.214.118.137:80
# ","109.94.182.128:4145
# ","159.89.228.253:38172
# ","134.19.254.2:21231
# ","202.138.242.6:38373
# ","41.205.24.153:8080
# ","193.106.57.7:33429
# ","119.252.167.130:5678
# ","202.141.233.66:8080
# ","5.178.204.235:2082
# ","84.22.36.138:31915
# ","41.174.179.147:8080
# ","149.28.177.203:8975
# ","103.103.212.222:53281
# ","200.69.210.59:80
# ","35.233.16.212:80
# ","201.238.248.134:443
# ","103.141.108.122:9812
# ","14.63.1.108:4145
# ","167.71.230.124:8080
# ","183.89.54.69:8080
# ","78.28.152.111:80
# ","54.38.146.209:8000
# ","43.129.29.58:8090
# ","47.74.226.8:5001
# ","167.99.236.14:80
# ","95.59.26.129:80
# ","23.238.33.186:80
# ","198.199.86.11:3128
# ","3.80.78.222:80
# ","209.97.150.167:3128
# ","159.203.61.169:8080
# ","20.232.181.11:3128
# ","154.16.63.16:8080
# ","128.199.202.122:3128
# ","5.252.161.48:3128
# ","203.223.40.186:8080
# ","177.73.155.34:999
# ","103.87.169.186:56642
# ","181.129.183.19:53281
# ","118.136.85.8:8080
# ","102.68.128.214:8080
# ","88.135.89.179:9812","92.118.92.107:8181"]

    # software_names = [SoftwareName.CHROME.value]
    # operating_systems = [OperatingSystem.WINDOWS.value, OperatingSystem.LINUX.value]

    # user_agent_rotator = UserAgent(software_names=software_names, operating_systems=operating_systems, limit=100)

    # Get list of user agents.
    # user_agents = user_agent_rotator.get_user_agents()

     # Get Random User Agent String.
     # user_agent = user_agent_rotator.get_random_user_agent()


    headers = {
        'User-Agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.115 Safari/537.36 OPR/88.0.4412.75",
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
        "accept-encoding": "gzip, deflate, br",
        "accept-language": "en-US,en;q=0.9",
        "cache-control": "max-age=0",
        "cookie": "_ga=GA1.2.2070874437.1656908385; _gid=GA1.2.574326801.1657417142; _tz=Europe%2FMoscow; _sess=d3JqcnJhOFF4YUt2bmNEQXBpRCtNVkZHeFNxVnBUeUxWVVRCSXpPQytKaWVFV3RCTFZzczRIVjFYWGpRZVFjNjZBZ3BRVUZHdTduemd6NmZVVU94Q1dUcmJpdFpNN0RUdVdJb0RvbjNzYkN5Y0FmMWZlUVdEY3FRSGM4VEJTQnpZUW90VXVncWRnUUEvUGZteEs5OVhxNWFuQlkxZmRTdnlmK25lVDJZY0F5YURLNjE0ay9tWGc2eTlIUm1BeDMyLS1SMjcvUzFZTE43SEJUeEtGb0VTM0Z3PT0%3D--431892d7608e04f764145311521c2908b89e43b2; _gat=1; _hi=25912892185090218590",
        "if-none-match": 'W/"erqw9ri9ifas9if9i1f91if9"',
        "sec-ch-ua": '"Chromium";v="102", "Opera GX";v="88", ";Not A Brand";v="99"',
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "Windows",
        "sec-fetch-dest": "document",
        "sec-fetch-mode": "navigate",
        "sec-fetch-site": "none",
        "sec-fetch-user": "?1",
        "upgrade-insecure-requests": "1",
    }
    proxy = "92.255.164.166:4145"
    # session.proxies = session.proxies = {"http": proxy, "https": proxy}

    print(headers)
    # print(random_proxy())


    # option = Options()
    # option.add_argument("--disable-infobars")
    # browser = webdriver.Chrome('C:\webdr\chromedriver.exe',chrome_options=option)

    # headers={'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36'}
    url = f'https://www.dotabuff.com/players/{userId}/matches?'

    if hero_id != 404:
        hero_name = returnHeroViaId(hero_id)["name"]
        url += f"&hero={hero_name}"
    proxy = "http://77.220.40.102:1080/"
    try:
        response = session.get(url)
    except:
        print(proxy)
        return None

    print(url)
    print(response)



    soup = BeautifulSoup(response.content, 'html.parser')

    # regex = r"+\d"
    matches = []
    for el in soup.select('.cell-large'):
        a = el.select('a')
        href = a[0]['href']
        match_id = re.search(regex, href).group(0)
        matches.append(match_id)

    return matches


getDBMatches(230214679)
